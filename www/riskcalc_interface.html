<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="stylefiles/global_styles.css">

    <script src="jquery/jquery-3.7.1.min.js"></script>

    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="global_scripts.js"></script>

    <title>Risk calculator test</title>
</head>
<body>


<div class="flex-container current-theme">


    <div id="header-section">
    </div>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ MAIN CONTENT ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- The flexible grid (content) -->
    <div class="row current-theme">
        <div class="full-column">
            <h1>Calculate risks</h1>
        </div>

    </div>
    <div class="row current-theme">


        <div class="input-col number-input">
            <p>Kontrollgruppe:</p>
            Erkrankt: <input type="text" width="5px" id="n1">
            <br>
            Gesund: <input type="text" width="1em" id="n2">
            <br><br>

            <p>Geimpfte:</p>
            Erkrankt: <input type="text" width="1em" id="n3">
            <br>
            Gesund: <input type="text" width="1em" id="n4">

            <button class="input-button" id="check-numbers">Go!</button>
        </div>


        <!--    The results from providing numbers:-->
        <div class="output-col number-output">

            <div class="canvas-container">
                <canvas id="dotdisplay"></canvas>
            </div>

        </div>


    </div>
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ EOF MAIN CONTENT ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- Footer -->
    <div class="footer">
        <h2>Footer</h2>
    </div>

    <!--For flexbox: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_flexible_box_layout/Basic_concepts_of_flexbox-->


</div>

<!--Include risk calculation script:-->
<script src="scripts/calculate_risk.js"></script>

<script>

    // const input = document.getElementById('input')
    // const onlyNumbersRegExp = /^\d+$/;
    //
    // input.addEventListener('input', function() {
    //   if (onlyNumbersRegExp.test(input.value)) {
    //     console.log('only numbers');
    //   } else {
    //     console.log('not only numbers');
    //   }
    // })


    $("#check-numbers").on("click", function () {

        // Check for non-integer inputs:
        // https://stackoverflow.com/questions/469357/html-text-input-allow-only-numeric-input/469362#469362

        // Create an ordered array:
        try {
            // Check for integers (numbers( using "try" for now.
            // Update in time!
            // TODO: Proper input checking!
            const n1 = parseInt($("#n1").val());
            const n2 = parseInt($("#n2").val());
            const n3 = parseInt($("#n3").val());
            const n4 = parseInt($("#n4").val());
            const n_dots = n1 + n2 + n3 + n4;

            // Create an array of types:
            // Determine number of rows:
            // TODO: This could be optimally determined and the classes may be blocked like in riskyr.
            const ncols = 10;  // Math.floor(n_dots / 10);  // n_dots % 10;  // remainder.
            const remainder = n_dots % ncols;
            const nrows = Math.floor(n_dots / ncols) + ((remainder > 0) ? Math.floor(remainder/10) : 0);

            console.log(n_dots + " dots, " + nrows + " rows and " + ncols + " columns");

            // Create a vector of dot types:
            const type_vec = Array(n1).fill(1).concat(Array(n2).fill(2), Array(n3).fill(3), Array(n4).fill(4));
            console.log(type_vec);

            // Pad any missing elements with empty elements?

            // Create simple icon array:
            // May also benefit from fontawesome!
            (function () {

                'use strict';
                var c = document.getElementById('dotdisplay');
                // var t = document.getElementById('t');
                var ctx = c.getContext('2d');
                var w = c.width = 400;  // window.innerWidth;
                var h = c.height = 400;  // window.innerHeight;
                // Fixed values ensure equal height and width of points.
// current dots
                var balls = [];
                var total = n_dots;  // number of balls.
                // console.log("current noise: " + noise);
                var bounce = -1;


                // Add balls to the list and give them their direction:
                let icol = 0;
                let irow = 0;
                for (let i = 0; i < total; i++) {

                    if (i % ncols === 0) {
                        irow++;
                        icol = 0;
                    }

                    balls.push({
                        // Initiate random positions:
                        // x: Math.random() * w,
                        // y: Math.random() * h
                        x: (icol + 0.5) * w / 10,
                        y: (irow + 0.5) * w / 10,
                        type: type_vec[i]
                    })

                    icol++;


                }

// draw all balls each frame
                function draw() {
                    ctx.clearRect(0, 0, w, h);
                    var j, dot;
                    for (j = 0; j < total; j++) {
                        dot = balls[j];  // get the ball.
                        ctx.beginPath();
                        ctx.arc(dot.x, dot.y, 6, 0, Math.PI * 2, false);  // second parameter controls size.
                        // console.log(dot);

                        // Define dot colors:
                        const col_arr = ["#90f6d7", "#41506b", "#35bcbf", "#263849"];
                        ctx.fillStyle = col_arr[dot.type - 1];

                        // noise dots unfilled.
                        // ctx.fillStyle = "rgb(0,0,0)";
                        ctx.fill();
                        ctx.strokeStyle = 'black';  // stroke for those with noise.
                        (dot.type % 2 === 0) ? ctx.stroke() : '';
                    }

                }

                // loop the animation
                // requestAnimationFrame(function loop() {
                //     requestAnimationFrame(loop);
                draw();
                // });


            })();
        }
        catch(err) {
            alert("Bitte geben Sie eine ganze Zahl ein!");
            console.log(err);
        }

    })


</script>

</body>


</html>